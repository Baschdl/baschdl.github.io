<!DOCTYPE html>
<html>
<head>
    <title>Snow cover</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="https://carto.com/favicon.ico"/>
    <style>
        html, body, #map {
            height: 100%;
            padding: 0;
            margin: 0;
        }
    </style>

    <link rel="stylesheet" href="https://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css"/>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700|Open+Sans:300,400,600" rel="stylesheet">
    <!-- Include Leaflet -->
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
    <link href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" rel="stylesheet">
    <!-- Include CARTO.js -->
    <script src="https://libs.cartocdn.com/carto.js/v4.2.0/carto.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:600" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://carto.com/developers/carto-js/examples/maps/public/style.css" rel="stylesheet">
</head>
<body>

<div id="map"></div>

<script src="style.js" type="text/javascript"></script>
<script>

    const map = L.map('map').setView([46.3, 7], 10);

    // Adding Voyager Basemap
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}.png', {
        maxZoom: 18
    }).addTo(map);

    // Adding Voyager Labels
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}.png', {
        maxZoom: 18,
        zIndex: 10
    }).addTo(map);


    var client = new carto.Client({
        apiKey: 'WZ8I_z2BY2c7zgfu5l-3tQ',
        username: 'snow',
        serverUrl: 'https://much-snow.is-very-bad.org/user/snow',
    });

    const dataset = `sentinel2b_20200519_103804_416_l2b_snow_t32tls_c_v1_7_snw_r2`

    const noDataDataset = new carto.source.Dataset(dataset);
    const noDataFilter = new carto.filter.Range('dn', {gte: 205});
    noDataDataset.addFilter(noDataFilter);

    const snowDataset = new carto.source.Dataset(dataset);
    const snowFilter = new carto.filter.Range('dn', {lte: 100, gte: 100});
    snowDataset.addFilter(snowFilter);

    const snowStyle = new carto.style.CartoCSS(getSnowStyle());
    const noDataStyle = new carto.style.CartoCSS(getNoDataStyle());

    const snowLayer = new carto.layer.Layer(snowDataset, snowStyle);
    const noDataLayer = new carto.layer.Layer(noDataDataset, noDataStyle);

    client.addLayers([snowLayer, noDataLayer]);

    client.getLeafletLayer().addTo(map);

</script>
</body>
</html>